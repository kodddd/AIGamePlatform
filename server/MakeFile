
# å®šä¹‰å˜é‡
APP_NAME := game-platform
GO := go
PORT ?= 8080
BINARY_DIR := ../bin  # å¯æ‰§è¡Œæ–‡ä»¶è¾“å‡ºåˆ°ä¸Šçº§binç›®å½•

.PHONY: all run build clean fmt mod errcheck

# é»˜è®¤ç›®æ ‡
all: build

# è¿è¡Œå¼€å‘æœåŠ¡å™¨ï¼ˆä½¿ç”¨å½“å‰ç›®å½•çš„main.goï¼‰
run:
	@echo "ğŸš€ Starting server on port $(PORT)..."
	$(GO) run . --port $(PORT)

# æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆè¾“å‡ºåˆ°é¡¹ç›®æ ¹ç›®å½•çš„binæ–‡ä»¶å¤¹ï¼‰
build:
	@echo "ğŸ“¦ Building $(APP_NAME)..."
	@mkdir -p $(BINARY_DIR)
	$(GO) build -o $(BINARY_DIR)/$(APP_NAME) .

# æ¸…ç†æ„å»ºæ–‡ä»¶
clean:
	@echo "ğŸ§¹ Cleaning..."
	@rm -rf $(BINARY_DIR)

# æ ¼å¼åŒ–ä»£ç ï¼ˆé€’å½’æ ¼å¼åŒ–å½“å‰ç›®å½•ï¼‰
fmt:
	$(GO) fmt ./...

# æ•´ç†ä¾èµ–
mod:
	$(GO) mod tidy

# é”™è¯¯æ£€æŸ¥
errcheck:
	@$(GO) install github.com/kisielk/errcheck@latest
	errcheck ./...

# æ–°å¢ï¼šå¿«é€Ÿæµ‹è¯•æ¥å£
test:
	@echo "ğŸ›œ Testing /ping endpoint..."
	@curl -s http://localhost:$(PORT)/ping | jq . 2>/dev/null || echo "âš ï¸ è¯·å…ˆå¯åŠ¨æœåŠ¡ï¼ˆmake runï¼‰"